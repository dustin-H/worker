"use strict";(self.webpackChunkgraphile_worker=self.webpackChunkgraphile_worker||[]).push([[8269],{9916:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>c});var a=n(3696);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},g=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,g=s(e,["components","mdxType","originalType","parentName"]),h=p(n),d=r,c=h["".concat(l,".").concat(d)]||h[d]||u[d]||o;return n?a.createElement(c,i(i({ref:t},g),{},{components:n})):a.createElement(c,i({ref:t},g))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[h]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3740:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>g});var a=n(8102),r=(n(3696),n(9916)),o=n(7142);const i={title:"Worker 0.16 released",description:"Graphile Worker Version 0.16 is now ready, and brings a new plugin system along with many other features!",slug:"2023-12-11-016-release",authors:[{name:"Benjie",title:"Creator of Worker",url:"https://github.com/Benjie",image_url:"https://github.com/Benjie.png"},{name:"Jem",title:"\u201cI wear many hats\u201d",url:"https://fosstodon.org/@jem",image_url:"https://github.com/jemgillam.png"}],tags:["releases"]},s=void 0,l={permalink:"/news/2023-12-11-016-release",source:"@site/news/2023-12-11-016-release.mdx",title:"Worker 0.16 released",description:"Graphile Worker Version 0.16 is now ready, and brings a new plugin system along with many other features!",date:"2023-12-11T00:00:00.000Z",formattedDate:"December 11, 2023",tags:[{label:"releases",permalink:"/news/tags/releases"}],readingTime:6.905,hasTruncateMarker:!1,authors:[{name:"Benjie",title:"Creator of Worker",url:"https://github.com/Benjie",image_url:"https://github.com/Benjie.png",imageURL:"https://github.com/Benjie.png"},{name:"Jem",title:"\u201cI wear many hats\u201d",url:"https://fosstodon.org/@jem",image_url:"https://github.com/jemgillam.png",imageURL:"https://github.com/jemgillam.png"}],frontMatter:{title:"Worker 0.16 released",description:"Graphile Worker Version 0.16 is now ready, and brings a new plugin system along with many other features!",slug:"2023-12-11-016-release",authors:[{name:"Benjie",title:"Creator of Worker",url:"https://github.com/Benjie",image_url:"https://github.com/Benjie.png",imageURL:"https://github.com/Benjie.png"},{name:"Jem",title:"\u201cI wear many hats\u201d",url:"https://fosstodon.org/@jem",image_url:"https://github.com/jemgillam.png",imageURL:"https://github.com/jemgillam.png"}],tags:["releases"]}},p={authorsImageUrls:[void 0,void 0]},g=[{value:"Reliable, extensible and performant",id:"reliable-extensible-and-performant",level:2},{value:"What\u2019s new in Version 0.16?",id:"whats-new-in-version-016",level:3},{value:"Graphile Worker gets a logo!",id:"graphile-worker-gets-a-logo",level:4},{value:"New Graphile Worker website!",id:"new-graphile-worker-website",level:4},{value:"Graphile Config and the new plugin system",id:"graphile-config-and-the-new-plugin-system",level:4},{value:"Native ESM support!",id:"native-esm-support",level:4},{value:"Compile\u2013to\u2013JS language support!",id:"compiletojs-language-support",level:4},{value:"Tasks in even more languages!",id:"tasks-in-even-more-languages",level:4},{value:"abortSignal",id:"abortsignal",level:4},{value:"Opt\u2013in TypeScript typing of tasks",id:"optin-typescript-typing-of-tasks",level:4},{value:"Public jobs view",id:"public-jobs-view",level:4},{value:"Worker Pro: upgrade your experience!",id:"worker-pro-upgrade-your-experience",level:4}],h={toc:g},u="wrapper";function d(e){let{components:t,...i}=e;return(0,r.yg)(u,(0,a.A)({},h,i,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"reliable-extensible-and-performant"},"Reliable, extensible and performant"),(0,r.yg)("p",null,"Worker 0.16 is here \u2014 freshly updated with optional TypeScript typing for tasks,\na public ",(0,r.yg)("inlineCode",{parentName:"p"},"jobs")," interface, a new plugin system, and much more besides!"),(0,r.yg)("p",null,"The new plugin system enables ESM and CommonJS to peacefully coexist, adds\nsupport for writing tasks in ",(0,r.yg)("inlineCode",{parentName:"p"},"import()"),"\u2013capable compile\u2013to\u2013JS languages like\nTypeScript, adds support for writing tasks in alternative languages (e.g.\nPython, Ruby, Rust), and could open the door to a lot more customizability in\nfuture! Version 0.16 also introduces support for \u201cWorker Pro\u201d \u2014 a plugin\navailable to most Sponsors which monitors running workers, releases locked jobs\nfrom workers that exit uncleanly, helps ease migrations to new releases, and\nwill add more quality\u2013of\u2013life improvements in time."),(0,r.yg)("p",null,"We\u2019ve backported a large amount of v0.16\u2019s functionality to v0.13 and v0.15;\nthis includes plugin and Worker Pro support to ease migration to the new\nversion."),(0,r.yg)("p",null,"Thank you to each and every one of our sponsors, together you have made this\nmassive release possible!"),(0,r.yg)("div",{class:"prettyDivide"},(0,r.yg)(o.A,{mdxType:"FooterImage"})),(0,r.yg)("h3",{id:"whats-new-in-version-016"},"What\u2019s new in Version 0.16?"),(0,r.yg)("h4",{id:"graphile-worker-gets-a-logo"},"Graphile Worker gets a logo!"),(0,r.yg)("p",null,"Inspired by the Graphile heart and the PostGraphile elephant, Graphile Worker\ngets its new heart\u2013shaped worker\u2013ant logo. We admire the industriousness of\nrainforest leaf\u2013cutter ants, relentlessly working away traversing miles of\nbranches to bring food and messages back to their colony. What better animal to\nrepresent the spirit of Graphile Worker?"),(0,r.yg)("figure",null,(0,r.yg)("p",null,(0,r.yg)("a",{target:"_blank",href:n(5300).A},(0,r.yg)("img",{alt:"The new Graphile Worker logo is an ant face",src:n(637).A,width:"900",height:"520"})))),(0,r.yg)("h4",{id:"new-graphile-worker-website"},"New Graphile Worker website!"),(0,r.yg)("p",null,"As Graphile Worker\u2019s featureset has been growing, managing it all through a\nREADME has become challenging, both for users and for maintenance. We\u2019ve moved\nall the documentation to a new website and spent some time overhauling it with\nnew tips and notes (and corrections). You\u2019re on that new site right now! See the\nnew documentation at ",(0,r.yg)("a",{parentName:"p",href:"/docs/"},"worker.graphile.org/docs/"),"."),(0,r.yg)("h4",{id:"graphile-config-and-the-new-plugin-system"},"Graphile Config and the new plugin system"),(0,r.yg)("p",null,"Worker is now optionally configurable with ",(0,r.yg)("a",{parentName:"p",href:"/docs/config/"},"Graphile Config"),".\nThis enables a whole suite of new options and features, not the least of which\nis you can now share preset files across multiple projects! Graphile Config\ntakes everything we\u2019ve learned from the PostGraphile project relating to\nconfiguration and plugins and expands these capabilities into a generic system\nthat Worker can leverage. The plumbing has been completed, the initial hooks are\nthere and ready to be used by everyone to make Worker even more adaptable and\npowerful than ever before. If you need to do something that there\u2019s not a hook\nfor yet, adding a suitable one is likely straightforward\u2026 get in touch for\nguidance!"),(0,r.yg)("h4",{id:"native-esm-support"},"Native ESM support!"),(0,r.yg)("p",null,"The first thing we did with the new plugin system was to move the code for\nloading a task into its own plugin, and add support for loading both CommonJS\nfiles and ESM files. Since it\u2019s a plugin, you can replace it entirely, loading\ntasks in any way you see fit!"),(0,r.yg)("h4",{id:"compiletojs-language-support"},"Compile\u2013to\u2013JS language support!"),(0,r.yg)("p",null,"With the plugin mentioned above you can add more file extensions to your config\nfor any \u201ccompile\u2013to\u2013javascript\u201d language that can be ",(0,r.yg)("inlineCode",{parentName:"p"},"import()"),'\u2013ed \u2014 just be\nsure to make the relevant "loaders" available, e.g. for native TypeScript\nsupport you might use ',(0,r.yg)("inlineCode",{parentName:"p"},'NODE_OPTIONS="--loader ts-node/esm" npx graphile-worker')),(0,r.yg)("h4",{id:"tasks-in-even-more-languages"},"Tasks in even more languages!"),(0,r.yg)("p",null,"And the fun doesn't stop there! We've added another built\u2013in plugin that allows\nus to offer support for writing task executors in other languages entirely:\npython, bash, even ",(0,r.yg)("em",{parentName:"p"},"fortran"),"; choose whichever language makes the most sense for\nthe task at hand. All you need to do is place an executable file in the ",(0,r.yg)("inlineCode",{parentName:"p"},"tasks/"),"\nfolder and ensure it's named with the task identifier (extensions are ignored)."),(0,r.yg)("h4",{id:"abortsignal"},"abortSignal"),(0,r.yg)("p",null,"We have added the JavaScript pattern of ",(0,r.yg)("inlineCode",{parentName:"p"},"abortSignal")," \u2014 a new ability to tell\ntasks to abort during shutdown. This means no more waiting for the task to\ncomplete during a graceful shutdown, so long as your task executor remembers to\nlisten for the ",(0,r.yg)("inlineCode",{parentName:"p"},"abortSignal")," your job can exit quickly when the worker is\nshutting down, and boot up again soon thereafter on a different worker."),(0,r.yg)("h4",{id:"optin-typescript-typing-of-tasks"},"Opt\u2013in TypeScript typing of tasks"),(0,r.yg)("p",null,"Now you can take down the guard rails, and ",(0,r.yg)("em",{parentName:"p"},"assume")," the job type using the new\n",(0,r.yg)("inlineCode",{parentName:"p"},"GraphileWorker.Tasks")," global interface. This is not for the faint of heart, and\nin fact we don\u2019t generally recommend it! But it has been requested many times,\nand now it is available to use via a public\u2013facing declaration\u2013mergeable\ninterface. Declaring a global task interface allows you to use auto\u2013complete and\npayload safety for ",(0,r.yg)("inlineCode",{parentName:"p"},"addJob")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"quickAddJob"),", and specifies the assumed types\nof the payloads of your task functions. More, including important caveats, can\nbe found ",(0,r.yg)("a",{parentName:"p",href:"/docs/typescript"},"in our documentation"),"."),(0,r.yg)("figure",null,(0,r.yg)("p",null,(0,r.yg)("a",{target:"_blank",href:n(1018).A},(0,r.yg)("img",{alt:"Felix Unger from the Odd Couple shows the word assume makes an ass out of u and me.",src:n(1585).A,width:"806",height:"515"}))),(0,r.yg)("figcaption",null,(0,r.yg)("p",null,"Remember the caveats of\n",(0,r.yg)("a",{parentName:"p",href:"https://youtu.be/KEP1acj29-Y?si=4UDpo9oLW5zbrvnh&t=41"},"what it means to assume\u2026")))),(0,r.yg)("h4",{id:"public-jobs-view"},"Public jobs view"),(0,r.yg)("p",null,"This release makes it much clearer that the tables in which jobs and queues are\nstored are private implementation details \u2014 Graphile Worker needs to be able to\nchange these tables to add new features or perform optimizations. For those\nusers who look into the jobs table, even though we advise against it, we've\ncreated a public view that presents a stable interface into the queued jobs. We\nstrongly advise against polling this, it will impact the performance of your\nworker, but it is now more suitable for usage in automated scripts since the\ninterface is stable."),(0,r.yg)("h4",{id:"worker-pro-upgrade-your-experience"},"Worker Pro: upgrade your experience!"),(0,r.yg)("p",null,"With thanks to each and every sponsor (past and present) for reinvesting back\ninto open source, the growth of our community\u2013based funding over the last six\nyears has enabled us to spend more and more time maintaining and improving our\n",(0,r.yg)("a",{parentName:"p",href:"https://graphile.org"},"various open source packages"),". These past few months\nwe're grateful to welcome Trigger.dev and Seam as the latest in the\norganizations reinvesting in the software they use \u2014 thank you!"),(0,r.yg)("p",null,"Alas, a significant amount of our maintenance and development time is still\nself\u2013funded; so in an attempt to make this project more sustainable, we have\nintroduced the proprietary Worker Pro plugin, and initially made it available to\nsponsors on the $25/mo tier and above."),(0,r.yg)("p",null,'Worker Pro adds worker tracking to Graphile Worker, making it a clean separation\nfrom the open source version which does not track the individual workers. With\nWorker Pro, each worker checks in with a "heartbeat" every so often, and we can\nuse this in various ways.'),(0,r.yg)("p",null,"For example, we have had feedback from the community that having to stop all\nworkers in advance of updating to a new release is not ideal. With Worker Pro,\nbefore performing a breaking migration a graceful shutdown of all old workers is\ntriggered, and further old workers are prevented from starting up. Once Worker\nPro has confirmed all old workers have completed their graceful shutdowns, the\nmigration can go ahead with significantly reduced risk of conflict. This avoids\nthe need to \u201cscale to zero\u201d as all workers will communicate with each other to\nhelp the system as a whole remain consistent, and the newly running workers can\ngracefully take over from the old."),(0,r.yg)("p",null,"This new plugin also helps with crashed worker recovery: once a configurable\namount of time has passed without receiving a heartbeat from a registered\nworker, Worker Pro can assume that the worker is no longer running (power\npulled, killed, crashed, etc) and release all of its locked jobs to be\nre\u2013attempted."),(0,r.yg)("p",null,"There are a couple more major features planned for \u201cWorker Pro\u201d, and once they\nare added it will be available via the $100 sponsorship tier. Now is a great\ntime to ",(0,r.yg)("a",{parentName:"p",href:"https://graphile.org/sponsor"},"sponsor Graphile")," and lock in this\nawesome 75% discount launch offer for at least 18 months!"),(0,r.yg)("p",null,"To get access to \u201cWorker Pro\u201d, please reach out to Benjie or Jem on Discord or\nemail team ","[at]"," graphile ","[dot]"," org \u2014 for the introductory offer you must ensure\nyou have access before the price goes up!"),(0,r.yg)("p",null,(0,r.yg)("em",{parentName:"p"},"Join our community \u2014 we run ",(0,r.yg)("a",{parentName:"em",href:"https://discord.gg/graphile"},"a Discord server"),"\nwhich can be used for community support and to chat to others using the Graphile\nsuite of developer tools. Find out how to sponsor us at\n",(0,r.yg)("a",{parentName:"em",href:"https://graphile.org/sponsor"},"graphile.org/sponsor"),".")),(0,r.yg)("p",null,(0,r.yg)("em",{parentName:"p"},"Full release notes found ",(0,r.yg)("a",{parentName:"em",href:"/releases/"},"on this site")," or\n",(0,r.yg)("a",{parentName:"em",href:"https://github.com/graphile/worker/blob/main/RELEASE_NOTES.md"},"at GitHub"),".")),(0,r.yg)("figure",null,(0,r.yg)("p",null,(0,r.yg)("a",{target:"_blank",href:n(8038).A},(0,r.yg)("img",{alt:"A handdrawn image of an ant holding up a green heart",src:n(9107).A,width:"650",height:"575"}))),(0,r.yg)("figcaption",null,(0,r.yg)("p",null,"Thank you Graphile sponsors!"))))}d.isMDXComponent=!0},1018:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/files/2023-11-29-assumptions-03311f4c308eda042509d27cde8b2030.jpg"},5300:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/files/2023-11-29-graphile-logos-555d9e87d0ce3bddddc2e95906c8d02f.svg"},8038:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/files/ant-heart-162e53eda8026a745cadc655d4e7eb71.svg"},1585:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/2023-11-29-assumptions-03311f4c308eda042509d27cde8b2030.jpg"},637:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/2023-11-29-graphile-logos-555d9e87d0ce3bddddc2e95906c8d02f.svg"},9107:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/ant-heart-162e53eda8026a745cadc655d4e7eb71.svg"}}]);