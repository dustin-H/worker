"use strict";(self.webpackChunkgraphile_worker=self.webpackChunkgraphile_worker||[]).push([[4446],{5318:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(7378);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},k=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),k=o,m=c["".concat(s,".").concat(k)]||c[k]||d[k]||i;return t?r.createElement(m,a(a({ref:n},u),{},{components:t})):r.createElement(m,a({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=k;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:o,a[1]=l;for(var p=2;p<i;p++)a[p]=t[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}k.displayName="MDXCreateElement"},1226:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=t(5773),o=(t(7378),t(5318));const i={title:"Configuration",sidebar_position:41},a=void 0,l={unversionedId:"config",id:"config",title:"Configuration",description:"Graphile Worker does not require a configuration file, but you may find that",source:"@site/docs/config.md",sourceDirName:".",slug:"/config",permalink:"/docs/config",draft:!1,editUrl:"https://github.com/graphile/worker/tree/main/website/docs/config.md",tags:[],version:"current",sidebarPosition:41,frontMatter:{title:"Configuration",sidebar_position:41},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/docs/installation"},next:{title:"Connection strings",permalink:"/docs/connection-string"}},s={},p=[{value:"Examples",id:"examples",level:2},{value:"<code>worker</code> options",id:"worker-options",level:2},{value:"worker.concurrentJobs",id:"workerconcurrentjobs",level:3},{value:"worker.connectionString",id:"workerconnectionstring",level:3},{value:"worker.crontabFile",id:"workercrontabfile",level:3},{value:"worker.events",id:"workerevents",level:3},{value:"worker.fileExtensions",id:"workerfileextensions",level:3},{value:"worker.gracefulShutdownAbortTimeout",id:"workergracefulshutdownaborttimeout",level:3},{value:"worker.logger",id:"workerlogger",level:3},{value:"worker.maxPoolSize",id:"workermaxpoolsize",level:3},{value:"worker.maxResetLockedInterval",id:"workermaxresetlockedinterval",level:3},{value:"worker.minResetLockedInterval",id:"workerminresetlockedinterval",level:3},{value:"worker.pollInterval",id:"workerpollinterval",level:3},{value:"worker.preparedStatements",id:"workerpreparedstatements",level:3},{value:"worker.schema",id:"workerschema",level:3},{value:"worker.taskDirectory",id:"workertaskdirectory",level:3},{value:"worker.useNodeTime",id:"workerusenodetime",level:3}],u={toc:p},c="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(c,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Graphile Worker does not require a configuration file, but you may find that\nhaving a configuration file means you don't have to remember all the CLI flags\neach time you run it."),(0,o.kt)("p",null,"Graphile Worker is configured via a ",(0,o.kt)("inlineCode",{parentName:"p"},"graphile.config.js")," (or ",(0,o.kt)("inlineCode",{parentName:"p"},".ts"),", ",(0,o.kt)("inlineCode",{parentName:"p"},".mjs"),', ...)\nfile. This file must export a "Graphile Config preset" which is a POJO (plain\nold JavaScript object) containing keys such as ',(0,o.kt)("inlineCode",{parentName:"p"},"extends")," (to merge in extra\npresets), ",(0,o.kt)("inlineCode",{parentName:"p"},"plugins")," (to add plugins) and in our case ",(0,o.kt)("inlineCode",{parentName:"p"},"worker")," which contains the\nsettings for Graphile Worker."),(0,o.kt)("h2",{id:"examples"},"Examples"),(0,o.kt)("p",null,"Here's an example in JavaScript:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="graphile.config.js"',title:'"graphile.config.js"'},'module.exports = {\n  worker: {\n    connectionString: process.env.DATABASE_URL,\n    maxPoolSize: 10,\n    pollInterval: 2000,\n    preparedStatements: true,\n    schema: "graphile_worker",\n    crontabFile: "crontab",\n    concurrentJobs: 1,\n    fileExtensions: [".js", ".cjs", ".mjs"],\n  },\n};\n')),(0,o.kt)("p",null,"And an equivalent configuration in TypeScript:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="graphile.config.ts"',title:'"graphile.config.ts"'},'import type {} from "graphile-config";\nimport type {} from "graphile-worker";\n\nconst preset: GraphileConfig.Preset = {\n  worker: {\n    connectionString: process.env.DATABASE_URL,\n    maxPoolSize: 10,\n    pollInterval: 2000,\n    preparedStatements: true,\n    schema: "graphile_worker",\n    crontabFile: "crontab",\n    concurrentJobs: 1,\n    fileExtensions: [".js", ".cjs", ".mjs"],\n  },\n};\n\nexport default preset;\n')),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"TypeScript uses the imports just so it understands what options are available,\nthese will not be included in the output JavaScript.")),(0,o.kt)("h2",{id:"worker-options"},(0,o.kt)("inlineCode",{parentName:"h2"},"worker")," options"),(0,o.kt)("p",null,"The options available will be influenced by the plugins and presets you are\nusing in your configuration (if any). To see the full list, you can use\nTypeScript's autocomplete, or run ",(0,o.kt)("inlineCode",{parentName:"p"},"graphile config options")," (assuming you have a\n",(0,o.kt)("inlineCode",{parentName:"p"},"graphile.config.ts")," file)."),(0,o.kt)("p",null,"Here are the options under the ",(0,o.kt)("inlineCode",{parentName:"p"},"worker")," key as defined by\n",(0,o.kt)("inlineCode",{parentName:"p"},"graphile config options")," when no plugins or presets are in use:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  concurrentJobs?: number;\n  connectionString?: string;\n  crontabFile?: string;\n  events?: WorkerEvents;\n  fileExtensions?: string[];\n  gracefulShutdownAbortTimeout?: number;\n  logger?: Logger<{}>;\n  maxPoolSize?: number;\n  maxResetLockedInterval?: number;\n  minResetLockedInterval?: number;\n  pollInterval?: number;\n  preparedStatements?: boolean;\n  schema?: string;\n  taskDirectory?: string;\n  useNodeTime?: boolean;\n}\n")),(0,o.kt)("h3",{id:"workerconcurrentjobs"},"worker.concurrentJobs"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined")),(0,o.kt)("p",null,"Number of jobs to run concurrently."),(0,o.kt)("h3",{id:"workerconnectionstring"},"worker.connectionString"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"string | undefined")),(0,o.kt)("p",null,"Database ",(0,o.kt)("a",{parentName:"p",href:"/docs/connection-string"},"connection string"),"."),(0,o.kt)("h3",{id:"workercrontabfile"},"worker.crontabFile"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"string | undefined")),(0,o.kt)("p",null,"Override path to crontab file."),(0,o.kt)("h3",{id:"workerevents"},"worker.events"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"WorkerEvents | undefined")),(0,o.kt)("p",null,"A Node.js ",(0,o.kt)("inlineCode",{parentName:"p"},"EventEmitter")," that exposes certain events within the runner (see\n",(0,o.kt)("a",{parentName:"p",href:"/docs/worker-events"},(0,o.kt)("inlineCode",{parentName:"a"},"WorkerEvents")),")."),(0,o.kt)("h3",{id:"workerfileextensions"},"worker.fileExtensions"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"string[] | undefined")),(0,o.kt)("p",null,"A list of file extensions (in priority order) that Graphile Worker should\nattempt to import directly when loading tasks. Defaults to\n",(0,o.kt)("inlineCode",{parentName:"p"},'[".js", ".cjs", ".mjs"]'),"."),(0,o.kt)("h3",{id:"workergracefulshutdownaborttimeout"},"worker.gracefulShutdownAbortTimeout"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined")),(0,o.kt)("p",null,"How long in milliseconds after a gracefulShutdown is triggered should we wait to\ntrigger the AbortController, which should cancel supported asynchronous actions?"),(0,o.kt)("h3",{id:"workerlogger"},"worker.logger"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"Logger<{}> | undefined")),(0,o.kt)("p",null,"A Logger instance."),(0,o.kt)("h3",{id:"workermaxpoolsize"},"worker.maxPoolSize"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined")),(0,o.kt)("p",null,"Maximum number of concurrent connections to Postgres"),(0,o.kt)("h3",{id:"workermaxresetlockedinterval"},"worker.maxResetLockedInterval"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Experimental")),(0,o.kt)("p",null,"The upper bound of how long we'll wait between scans for jobs that have been\nlocked too long. See ",(0,o.kt)("inlineCode",{parentName:"p"},"minResetLockedInterval"),"."),(0,o.kt)("h3",{id:"workerminresetlockedinterval"},"worker.minResetLockedInterval"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Experimental")),(0,o.kt)("p",null,"How often should we scan for jobs that have been locked too long and release\nthem? This is the minimum interval, we'll choose a time between this and\n",(0,o.kt)("inlineCode",{parentName:"p"},"maxResetLockedInterval"),"."),(0,o.kt)("h3",{id:"workerpollinterval"},"worker.pollInterval"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined")),(0,o.kt)("h3",{id:"workerpreparedstatements"},"worker.preparedStatements"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"boolean | undefined")),(0,o.kt)("h3",{id:"workerschema"},"worker.schema"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"string | undefined")),(0,o.kt)("p",null,"The database schema in which Graphile Worker is (to be) located."),(0,o.kt)("h3",{id:"workertaskdirectory"},"worker.taskDirectory"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"string | undefined")),(0,o.kt)("p",null,"Override path to find tasks"),(0,o.kt)("h3",{id:"workerusenodetime"},"worker.useNodeTime"),(0,o.kt)("p",null,"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"boolean | undefined")),(0,o.kt)("p",null,"Set ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," to use the time as recorded by Node.js rather than PostgreSQL. It's\nstrongly recommended that you ensure the Node.js and PostgreSQL times are\nsynchronized, making this setting moot."))}d.isMDXComponent=!0}}]);